{% extends 'admin_dashboard.html' %}
{% block content %}
<style>
    body {font-family: Arial, Helvetica, sans-serif;}
    * {box-sizing: border-box;}
    
    input[type=text], select, textarea, input[type=email], input[type=password], input[type=number], input[type=file] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      margin-top: 6px;
      margin-bottom: 16px;
      resize: vertical;
    }
    
    input[type=submit] {
      background-color: #04AA6D;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    input[type=submit]:hover {
      background-color: #45a049;
    }
    
    .container {
      border-radius: 5px;
      background-color: #f2f2f2;
      padding: 20px;
    }
</style>
    
    
<h2>Add Weekly Task</h2>
<div class="container">
    <form method="POST" action="">
        {% csrf_token %}
        <div class="container mt-4">
            <div class="row mb-3">
                <!-- Month -->
                <div class="col-md-3">
                    <label for="month" class="form-label">Month</label>
                    <select name="month" id="month" class="form-select">
                        <option value="">Select Month</option>
                        {% for m in months %}
                            <option value="{{ m }}">{{ m }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Week -->
                <div class="col-md-3">
                    <label for="week" class="form-label">Week</label>
                    <select name="week" id="week" class="form-select">
                        <option value="">Select Week</option>
                    </select>
                </div>

                <!-- User -->
              <div class="col-md-3">
    <label for="user" class="form-label">User</label>
    <input type="text" id="userSearch" class="form-control mb-2" placeholder="Type to filter...">
    <select id="user" name="user" class="form-select">
         <option value="">Select Name</option>
        {% for u in users %}
            <option value="{{ u.id }}">{{ u.name }}</option>
        {% endfor %}
    </select>
</div>

                <!-- Marks -->
                <div class="col-md-3">
                    <label for="marks" class="form-label">Marks</label>
                    <input type="number" id="marks" name="marks" class="form-control" value="0" oninput="updateTotal()">
                    <small class="text-muted">Old: <span id="oldMarks">0</span> | Total: <span id="totalMarks">0</span></small>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </div>
    </form>

    <p><a href="{% url 'event_list' %}">View Events</a></p>
</div>

<!-- âœ… Keep script inside block so DOM exists -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const monthSelect = document.getElementById("month");
    const weekSelect = document.getElementById("week");

    monthSelect.addEventListener("change", function () {
        const month = this.value;
        weekSelect.innerHTML = '<option value="">Select Week</option>';

        if (!month) return;

        // Max weeks (February = 4, others = 5 for simplicity)
        let weeks = (month === "February") ? 4 : 5;

        for (let i = 1; i <= weeks; i++) {
            const opt = document.createElement("option");
            opt.value = i;
            opt.textContent = "Week " + i;
            weekSelect.appendChild(opt);
        }
    });
});

// Marks calculation
let oldMarks = 0;
function updateTotal() {
    const newMarks = parseInt(document.getElementById("marks").value) || 0;
    const total = oldMarks + newMarks;
    document.getElementById("oldMarks").textContent = oldMarks;
    document.getElementById("totalMarks").textContent = total;
}
</script>

<script>
    document.getElementById("userSearch").addEventListener("keyup", function() {
        let filter = this.value.toLowerCase();
        let options = document.getElementById("user").options;

        for (let i = 0; i < options.length; i++) {
            let text = options[i].text.toLowerCase();
            if (text.startsWith(filter)) {
                options[i].style.display = "";
            } else {
                options[i].style.display = "none";
            }
        }
    });
</script>
{% endblock %}
